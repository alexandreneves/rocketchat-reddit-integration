class Script{constructor(){this.config={url:"https://www.reddit.com",nsfw:!1,subreddit:"worldnews",filter:"new",limit:3,limitMax:15,user:{alias:"Reddit",avatar:"https://i.imgur.com/7pQqJNy.png"},msg:{error:{text:"an error occurred, please try again"},nsfw:{title:"Ya filthy animal!",title_link:"http://reddit.com/r/eyebleach",text:"Never gonna give you up! Never gonna let you down!",image_url:"http://media.giphy.com/media/olAik8MhYOB9K/giphy.gif",color:"red",collapsed:!0}}}}getParams(t){const e=t.data.text.toLowerCase().trim().split(" ");e.shift();let[i=this.config.subreddit,r=this.config.filter,s=this.config.limit]=e;return{subreddit:i,filter:r,limit:s=s>this.config.limitMax?this.config.limitMax:s}}prepare_outgoing_request({request:t}){const e=this.getParams(t),i=HTTP("GET",`${this.config.url}/r/${e.subreddit}/about.json`);if(!i||i.error)return{message:{...this.config.user,...this.config.msg.error}};const r=JSON.parse(i.result.content);return r.data.id?!this.config.nsfw&&r.data.over18?{message:{...this.config.user,attachments:[this.config.msg.nsfw]}}:{url:`${this.config.url}/r/${e.subreddit}/${e.filter}.json?raw_json=1&limit=${e.limit}`,headers:t.headers,method:"GET"}:{message:{...this.config.user,text:`/r/${e.subreddit} not found`}}}process_outgoing_response({request:t,response:e}){if(!e||e.error)return{content:{...this.config.msg.error}};const i=JSON.parse(e.content_raw).data.children.map(t=>{const e={};if(!this.config.nsfw&&t.data.over18)e={...this.config.msg.nsfw};else{e.title=t.data.title,e.title_link=this.config.url+t.data.permalink,e.text=t.data.selftext,e.color="green",e.ts=new Date(1e3*t.data.created).toISOString(),e.collapsed=!0;try{const i=t.data.preview.images[0];i.variants.gif?e.image_url=i.variants.gif.source.url:e.image_url=i.source.url}catch(t){}}return e});return{content:{...this.config.user,attachments:i}}}}
